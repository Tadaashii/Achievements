<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <title>Popup Animation</title>
    <meta name="duration" content="4000" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      body {
        transform-origin: center center;
      }
    </style>
  </head>
  <body>
    <meta width="600" height="150" />
    <div class="ach">
      <!-- în loc de icon din notificare, folosim direct GIF-ul -->
      <div class="icon">
        <img src="./giphy.gif" alt="Icon GIF" height="15" />
      </div>
      <div class="text_wrap">
        <p class="title"><span class="title-inner"></span></p>
        <span class="detail"></span>
      </div>
      <div class="ring-container">
        <div class="ringring"></div>
        <div class="circle">
          <!-- aici era psicon.png, acum e steamicon.png -->
          <img src="./steamicon.png" height="15" />
        </div>
      </div>
    </div>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        window.api.onNotification((notificationData) => {
          const titleEl = document.querySelector(".title");
          const titleInnerEl = document.querySelector(".title-inner");
          const detailEl = document.querySelector(".detail");

          if (
            notificationData &&
            notificationData.displayName &&
            notificationData.description
            // iconPath îl ignorăm CA SĂ RĂMÂNĂ GIF-ul
          ) {
            titleInnerEl.textContent = notificationData.displayName;
            detailEl.textContent = notificationData.description;

            // păstrăm logica de scale
            const scale = Math.max(
              0.01,
              parseFloat(notificationData.scale || 1)
            );
            const container = document.querySelector(".ach");
            container?.style?.setProperty("--scale", String(scale));
          }

          const container = document.querySelector(".ach");
          container.classList.add("active");

          // marquee doar dacă overflow-ează
          requestAnimationFrame(() => {
            try {
              titleInnerEl.getAnimations().forEach((a) => a.cancel());
            } catch {}
            titleEl.classList.remove("marquee");
            void titleEl.offsetWidth;
            const overflowX =
              (titleInnerEl.scrollWidth || 0) - (titleEl.clientWidth || 0);
            if (overflowX > 0) {
              const px = Math.ceil(overflowX + 24);
              titleEl.classList.add("marquee");
              titleInnerEl.animate(
                [
                  { transform: "translateX(0)" },
                  { transform: `translateX(-${px}px)` },
                ],
                {
                  duration: Math.max(3000, Math.round(px / 50) * 1000),
                  delay: 1200,
                  easing: "linear",
                  fill: "both",
                }
              );
            }
          });

          // închiderea rămâne IDENTICĂ
          setTimeout(() => {
            container.classList.remove("active");
            window.api.closeNotificationWindow();
          }, 4000);
        });
      });
    </script>
  </body>
</html>
